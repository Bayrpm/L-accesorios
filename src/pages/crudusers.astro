---
import { supabase } from "../db/supabase";

// Función para obtener usuarios desde Supabase
export async function getUsuarios() {
  try {
    const { data, error } = await supabase.from("usuario").select("*");

    if (error) {
      throw error;
    }

    return data;
  } catch (error) {
    console.error("Error al obtener usuarios:", error);
    return [];
  }
}

// Obtener datos de usuarios
const usuarios = await getUsuarios();

const eliminarUsuario = async (idUsuario) => {
    try {
      const response = await fetch("/api/delete", {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ idusuario: idUsuario }),
      });

      if (response.ok) {
        // Refrescar la lista de usuarios después de eliminar
        const updatedUsuarios = usuarios.filter((usuario) => usuario.idusuario !== idUsuario);
        getUsuarios(updatedUsuarios);
      } else {
        console.error("Error al eliminar usuario:", response.statusText);
      }
    } catch (error) {
      console.error("Error al eliminar usuario:", error.message);
    }
  };
---
<div class="bg-blue-700">
<h2 class="text-xl font-bold mb-4">Lista de Usuarios</h2>
<div class="flex center mt-20 ml-60 mr-60 border-4 border-gray-600 bg-white">
  <table class="min-w-full divide-y divide-gray-800">
    <thead class="bg-gray-100">
      <tr>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          ID
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          Nombre
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          Apellido
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          Genero
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          Telefono
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          Creado En
        </th>
        <th
          class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
        >
          Opciones
        </th>
      </tr>
    </thead>
    <tbody>
      <!-- Iterar sobre los usuarios y renderizar cada fila -->
      {
        usuarios.map((usuario) => (
          <tr key={usuario.idusuario}>
            <td class="px-6 py-4 whitespace-nowrap">{usuario.idusuario}</td>
            <td class="px-6 py-4 whitespace-nowrap">{usuario.nombre}</td>
            <td class="px-6 py-4 whitespace-nowrap">{usuario.apellido}</td>
            <td class="px-6 py-4 whitespace-nowrap">{usuario.genero}</td>
            <td class="px-6 py-4 whitespace-nowrap">{usuario.telefono}</td>
            <td class="px-6 py-4 whitespace-nowrap">{usuario.creado_en}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <button
                onClick={() => eliminarUsuario(usuario.idusuario)}
                className="text-red-600 hover:text-red-800 mr-2"
              >
                Eliminar
              </button>
              <a
                href={`/usuario?id=${usuario.idusuario}`}
                class="text-blue-600 hover:text-blue-800"
              >
                Ver Detalles
              </a>
            </td>
          </tr>
        ))
      }
    </tbody>
  </table>
</div>
</div>
